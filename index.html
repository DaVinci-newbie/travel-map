<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº”ä¸€ç›®çš„åœ°æŠ½ç­¾</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft YaHei", sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }
        #container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #map {
            flex: 1;
            width: 100%;
        }
        #controls {
            padding: 15px;
            background: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        button {
            width: 100%;
            padding: 12px;
            background: #4D6BFF; /* é«˜å¾·ä¸»é¢˜è‰² */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .result {
            font-size: 14px;
            line-height: 1.6;
        }
        .highlight {
            color: #4D6BFF;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            color: #888;
            padding: 10px;
        }
        .spot-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="map"></div>
        <div id="controls">
            <button onclick="fetchRandomSpot()">ğŸ² éšæœºæ¨èæ™¯ç‚¹</button>
            <button onclick="locateUser()">ğŸ“ æˆ‘çš„ä½ç½®</button>
            <div id="result"></div>
        </div>
    </div>

        <!-- é«˜å¾·åœ°å›¾API -->
        <script src="https://webapi.amap.com/maps?v=2.0&key=9de5d8be2e64bfcd3d709e37df3bd8b6&plugin=AMap.PlaceSearch,AMap.Geolocation"></script>
        <script>
            // åˆå§‹åŒ–åœ°å›¾
            const map = new AMap.Map('map', {
                zoom: 5,
                center: [116.397, 39.918]
            });
    
            // æ·»åŠ æ§ä»¶
            AMap.plugin(['AMap.ToolBar', 'AMap.Scale'], function() {
                map.addControl(new AMap.ToolBar());
                map.addControl(new AMap.Scale());
            });
    
            // å­˜å‚¨æ™¯ç‚¹æ•°æ®
            let amapSpots = [];
            let currentMarker = null;
    
            // æ­£ç¡®çš„ä½ç½®è·å–æ–¹æ³•
            function locateUser() {
                const geolocation = new AMap.Geolocation({
                    enableHighAccuracy: true,
                    timeout: 5000
                });
                
                geolocation.getCurrentPosition((status, result) => {
                    if (status === 'complete') {
                        const lnglat = [result.position.lng, result.position.lat];
                        map.setCenter(lnglat);
                        map.setZoom(15);
                        
                        // æ˜¾ç¤ºä½ç½®æ ‡è®°
                        if (currentMarker) map.remove(currentMarker);
                        currentMarker = new AMap.Marker({
                            position: lnglat,
                            content: '<div style="background:#4D6BFF;color:white;padding:5px;border-radius:50%">ğŸ“</div>'
                        });
                        map.add(currentMarker);
                        
                        // æœç´¢å‘¨è¾¹æ™¯ç‚¹
                        searchNearbySpots(lnglat);
                    } else {
                        alert('å®šä½å¤±è´¥ï¼š' + result.message);
                    }
                });
            }
    
            // æœç´¢å‘¨è¾¹æ™¯ç‚¹
            function searchNearbySpots(lnglat) {
                const placeSearch = new AMap.PlaceSearch({
                    type: 'é£æ™¯åèƒœ|å…¬å›­',
                    pageSize: 20
                });
                
                placeSearch.searchNearBy('', lnglat, 5000, (status, result) => {
                    if (status === 'complete') {
                        amapSpots = result.poiList.pois;
                        document.getElementById('result').innerHTML = 
                            `æ‰¾åˆ°${amapSpots.length}ä¸ªå‘¨è¾¹æ™¯ç‚¹`;
                    }
                });
            }
    
            // éšæœºæ¨èæ™¯ç‚¹
            function fetchRandomSpot() {
                if (amapSpots.length === 0) {
                    loadDefaultSpots();
                    return;
                }
                
                const spot = amapSpots[Math.floor(Math.random() * amapSpots.length)];
                showSpot(spot);
            }
    
            // æ˜¾ç¤ºæ™¯ç‚¹
            function showSpot(spot) {
                if (currentMarker) map.remove(currentMarker);
                
                currentMarker = new AMap.Marker({
                    position: [spot.location.lng, spot.location.lat],
                    content: `<div style="background:#FF6B00;color:white;padding:5px 10px;border-radius:15px">
                        ${spot.name}
                    </div>`
                });
                map.add(currentMarker);
                map.setCenter([spot.location.lng, spot.location.lat]);
                
                // æ˜¾ç¤ºè¯¦æƒ…
                document.getElementById('result').innerHTML = `
                    <b>${spot.name}</b><br>
                    åœ°å€ï¼š${spot.address}<br>
                    ${spot.tel ? 'ç”µè¯ï¼š' + spot.tel : ''}
                `;
            }
    
            // åŠ è½½é»˜è®¤æ™¯ç‚¹æ•°æ®
            function loadDefaultSpots() {
                const placeSearch = new AMap.PlaceSearch({
                    city: 'å…¨å›½',
                    type: 'é£æ™¯åèƒœ',
                    pageSize: 50
                });
                
                placeSearch.search('å…¬å›­', (status, result) => {
                    if (status === 'complete') {
                        amapSpots = result.poiList.pois;
                        fetchRandomSpot();
                    }
                });
            }
    
            // å¾®ä¿¡åˆå§‹åŒ–é€‚é…
            if (/MicroMessenger/i.test(navigator.userAgent)) {
                document.addEventListener('WeixinJSBridgeReady', loadDefaultSpots, false);
            } else {
                window.onload = loadDefaultSpots;
            }
        </script>
    </body>
    </html>
