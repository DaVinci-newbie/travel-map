<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>五一目的地抽签</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft YaHei", sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }
        #container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #map {
            flex: 1;
            width: 100%;
        }
        #controls {
            padding: 15px;
            background: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        button {
            width: 100%;
            padding: 12px;
            background: #4D6BFF; /* 高德主题色 */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .result {
            font-size: 14px;
            line-height: 1.6;
        }
        .highlight {
            color: #4D6BFF;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            color: #888;
            padding: 10px;
        }
        .spot-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="map"></div>
        <div id="controls">
            <button onclick="fetchRandomSpot()">🎲 随机推荐景点</button>
            <button onclick="locateUser()">📍 我的位置</button>
            <div id="result"></div>
        </div>
    </div>

        <!-- 高德地图API -->
        <script src="https://webapi.amap.com/maps?v=2.0&key=9de5d8be2e64bfcd3d709e37df3bd8b6&plugin=AMap.PlaceSearch,AMap.Geolocation"></script>
        <script>
            // 初始化地图
            const map = new AMap.Map('map', {
                zoom: 5,
                center: [116.397, 39.918]
            });
    
            // 添加控件
            AMap.plugin(['AMap.ToolBar', 'AMap.Scale'], function() {
                map.addControl(new AMap.ToolBar());
                map.addControl(new AMap.Scale());
            });
    
            // 存储景点数据
            let amapSpots = [];
            let currentMarker = null;
    
            // 正确的位置获取方法
            function locateUser() {
                const geolocation = new AMap.Geolocation({
                    enableHighAccuracy: true,
                    timeout: 5000
                });
                
                geolocation.getCurrentPosition((status, result) => {
                    if (status === 'complete') {
                        const lnglat = [result.position.lng, result.position.lat];
                        map.setCenter(lnglat);
                        map.setZoom(15);
                        
                        // 显示位置标记
                        if (currentMarker) map.remove(currentMarker);
                        currentMarker = new AMap.Marker({
                            position: lnglat,
                            content: '<div style="background:#4D6BFF;color:white;padding:5px;border-radius:50%">📍</div>'
                        });
                        map.add(currentMarker);
                        
                        // 搜索周边景点
                        searchNearbySpots(lnglat);
                    } else {
                        alert('定位失败：' + result.message);
                    }
                });
            }
    
            // 搜索周边景点
            function searchNearbySpots(lnglat) {
                const placeSearch = new AMap.PlaceSearch({
                    type: '风景名胜|公园',
                    pageSize: 20
                });
                
                placeSearch.searchNearBy('', lnglat, 5000, (status, result) => {
                    if (status === 'complete') {
                        amapSpots = result.poiList.pois;
                        document.getElementById('result').innerHTML = 
                            `找到${amapSpots.length}个周边景点`;
                    }
                });
            }
    
            // 随机推荐景点
            function fetchRandomSpot() {
                if (amapSpots.length === 0) {
                    loadDefaultSpots();
                    return;
                }
                
                const spot = amapSpots[Math.floor(Math.random() * amapSpots.length)];
                showSpot(spot);
            }
    
            // 显示景点
            function showSpot(spot) {
                if (currentMarker) map.remove(currentMarker);
                
                currentMarker = new AMap.Marker({
                    position: [spot.location.lng, spot.location.lat],
                    content: `<div style="background:#FF6B00;color:white;padding:5px 10px;border-radius:15px">
                        ${spot.name}
                    </div>`
                });
                map.add(currentMarker);
                map.setCenter([spot.location.lng, spot.location.lat]);
                
                // 显示详情
                document.getElementById('result').innerHTML = `
                    <b>${spot.name}</b><br>
                    地址：${spot.address}<br>
                    ${spot.tel ? '电话：' + spot.tel : ''}
                `;
            }
    
            // 加载默认景点数据
            function loadDefaultSpots() {
                const placeSearch = new AMap.PlaceSearch({
                    city: '全国',
                    type: '风景名胜',
                    pageSize: 50
                });
                
                placeSearch.search('公园', (status, result) => {
                    if (status === 'complete') {
                        amapSpots = result.poiList.pois;
                        fetchRandomSpot();
                    }
                });
            }
    
            // 微信初始化适配
            if (/MicroMessenger/i.test(navigator.userAgent)) {
                document.addEventListener('WeixinJSBridgeReady', loadDefaultSpots, false);
            } else {
                window.onload = loadDefaultSpots;
            }
        </script>
    </body>
    </html>
