<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸­å›½æ—…è¡Œç›®çš„åœ°éšæœºé€‰æ‹©</title>
    <!-- ä½¿ç”¨å›½å†…CDNåŠ é€Ÿ -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/leaflet/1.7.1/leaflet.min.css">
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f7f7f7;
            height: 100vh;
            overflow: hidden;
        }
        #map-container {
            position: relative;
            height: 60vh;
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        #map {
            height: 100%;
        }
        #controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        button {
            width: 100%;
            padding: 12px;
            background: #07C160;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .result {
            font-size: 14px;
            line-height: 1.5;
        }
        .highlight {
            color: #07C160;
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="map-container">
        <div id="map"></div>
    </div>
    <div id="controls">
        <button onclick="selectRandomDestination()">ğŸ² éšæœºé€‰æ‹©ç›®çš„åœ°</button>
        <div id="result" class="result">
            ç‚¹å‡»æŒ‰é’®éšæœºé€‰æ‹©æ—…è¡Œç›®çš„åœ°<br>
            <span class="highlight">åŒ…å«å…¨å›½çƒ­é—¨æ™¯åŒºå’Œæ—…è¡Œè·¯çº¿</span>
        </div>
    </div>

    <!-- ä½¿ç”¨å›½å†…CDNåŠ é€Ÿ -->
    <script src="https://cdn.bootcdn.net/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>
    <script>
        // å¾®ä¿¡ç¯å¢ƒç‰¹æ®Šå¤„ç†
        function setupForWeixin() {
            // è§£å†³å¾®ä¿¡ä¸­åœ°å›¾æ‹–åŠ¨é—®é¢˜
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('#map')) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // è§£å†³ç‚¹å‡»å»¶è¿Ÿ
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON') {
                    e.preventDefault();
                    e.target.click();
                }
            }, true);
        }
        
        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            const map = L.map('map').setView([35.8617, 104.1954], 5);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap',
                maxZoom: 18
            }).addTo(map);
            
            return map;
        }
        
        // ç›®çš„åœ°æ•°æ®
        const destinations = [
            { name: "åŒ—äº¬æ•…å®«", coordinates: [39.9163, 116.3903], type: "5A", region: "ååŒ—" },
            { name: "æ­å·è¥¿æ¹–", coordinates: [30.2444, 120.1294], type: "5A", region: "åä¸œ" },
            { name: "æ¡‚æ—æ¼“æ±Ÿ", coordinates: [25.2345, 110.1799], type: "5A", region: "åå—" },
            // å…¶ä»–ç›®çš„åœ°æ•°æ®...
        ];
        
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æµ‹å¾®ä¿¡ç¯å¢ƒ
            if (/MicroMessenger/i.test(navigator.userAgent)) {
                setupForWeixin();
                alert("æ¸©é¦¨æç¤ºï¼šåœ¨å¾®ä¿¡ä¸­é•¿æŒ‰åœ°å›¾å¯ä»¥æ‹–åŠ¨æŸ¥çœ‹");
            }
            
            const map = initMap();
            let currentMarker = null;
            
            window.selectRandomDestination = function() {
                if (currentMarker) {
                    map.removeLayer(currentMarker);
                }
                
                const selected = destinations[Math.floor(Math.random() * destinations.length)];
                
                currentMarker = L.marker(selected.coordinates, {
                    icon: L.divIcon({
                        html: 'ğŸ“',
                        iconSize: [30, 30],
                        className: 'custom-marker'
                    })
                }).addTo(map);
                
                currentMarker.bindPopup(`
                    <b>${selected.name}</b><br>
                    åœ°åŒº: ${selected.region}<br>
                    ç±»å‹: ${selected.type}çº§æ™¯åŒº
                `).openPopup();
                
                document.getElementById('result').innerHTML = `
                    æ‚¨é€‰æ‹©çš„ç›®çš„åœ°æ˜¯:<br>
                    <span class="highlight">${selected.name}</span><br>
                    ä½äº: ${selected.region}åœ°åŒº
                `;
                
                map.flyTo(selected.coordinates, 8, {
                    duration: 1
                });
            }
            
            // åˆå§‹é€‰æ‹©
            selectRandomDestination();
        });
    </script>
</body>
</html>