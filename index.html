<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº”ä¸€ç›®çš„åœ°æŠ½ç­¾</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft YaHei", sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }
        #container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #map {
            flex: 1;
            width: 100%;
        }
        #controls {
            padding: 15px;
            background: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        button {
            width: 100%;
            padding: 12px;
            background: #4D6BFF; /* é«˜å¾·ä¸»é¢˜è‰² */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .result {
            font-size: 14px;
            line-height: 1.6;
        }
        .highlight {
            color: #4D6BFF;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            color: #888;
            padding: 10px;
        }
        .spot-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="map"></div>
        <div id="controls">
            <button onclick="fetchRandomSpot()">ğŸ² éšæœºæ¨èæ™¯ç‚¹</button>
            <div id="result" class="result">
                <div id="loading" class="loading">æ­£åœ¨åŠ è½½é«˜å¾·åœ°å›¾æ•°æ®...</div>
                <div id="content" style="display:none">
                    ç‚¹å‡»æŒ‰é’®éšæœºæŠ½ç­¾<br>
                    <span class="highlight">æ•°æ®æ¥æºï¼šé«˜å¾·åœ°å›¾API</span>
                </div>
            </div>
        </div>
    </div>

    <!-- é«˜å¾·åœ°å›¾API -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=9de5d8be2e64bfcd3d709e37df3bd8b6&plugin=AMap.PlaceSearch,AMap.AutoComplete"></script>
    <script>
        // é«˜å¾·åœ°å›¾é…ç½®
        const AMapConfig = {
            key: "9de5d8be2e64bfcd3d709e37df3bd8b6", // éœ€æ›¿æ¢ä¸ºå®é™…key
            city: "å…¨å›½",
            types: "é£æ™¯åèƒœ|å…¬å›­å¹¿åœº|åšç‰©é¦†" // æ™¯ç‚¹ç±»å‹
        };

        // åˆå§‹åŒ–åœ°å›¾
        const map = new AMap.Map('map', {
            zoom: 5,
            center: [114.218439, 30.554183],
            viewMode: '2D'
        });

        // å­˜å‚¨æ™¯ç‚¹æ•°æ®
        let amapSpots = [];
        let currentMarker = null;

        // åŠ è½½é«˜å¾·POIæ•°æ®
        function loadAMapSpots() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').style.display = 'none';

            // ä½¿ç”¨é«˜å¾·PlaceSearchæ’ä»¶
            const placeSearch = new AMap.PlaceSearch({
                city: AMapConfig.city,
                type: AMapConfig.types,
                pageSize: 50, // æ¯é¡µ50æ¡
                pageIndex: 1
            });

            // æœç´¢å…¨å›½æ™¯ç‚¹ï¼ˆå®é™…å¼€å‘ä¸­éœ€è¦åˆ†é¡µè·å–æ‰€æœ‰æ•°æ®ï¼‰
            placeSearch.search('å…¬å›­', (status, result) => {
                if (status === 'complete') {
                    amapSpots = processAMapData(result.poiList.pois);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';
                    fetchRandomSpot();
                } else {
                    document.getElementById('loading').innerHTML = 'æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•';
                }
            });
        }

        // å¤„ç†é«˜å¾·POIæ•°æ®
        function processAMapData(pois) {
            return pois.map(poi => ({
                id: poi.id,
                name: poi.name,
                location: [poi.location.lng, poi.location.lat],
                address: poi.address,
                tel: poi.tel,
                photos: poi.photos || [],
                rating: poi.biz_ext.rating || 'æ— è¯„åˆ†'
            }));
        }

        // éšæœºé€‰æ‹©æ™¯ç‚¹
        function fetchRandomSpot() {
            if (amapSpots.length === 0) {
                loadAMapSpots();
                return;
            }

            const randomSpot = amapSpots[Math.floor(Math.random() * amapSpots.length)];
            showSpot(randomSpot);
        }

        // æ˜¾ç¤ºæ™¯ç‚¹è¯¦æƒ…
        function showSpot(spot) {
            // æ¸…é™¤æ—§æ ‡è®°
            if (currentMarker) {
                map.remove(currentMarker);
            }

            // åˆ›å»ºæ–°æ ‡è®°
            currentMarker = new AMap.Marker({
                position: spot.location,
                content: `<div style="
                    background:#4D6BFF;
                    color:white;
                    padding:5px 10px;
                    border-radius:15px;
                    font-size:12px;
                    white-space:nowrap">
                    ğŸ“ ${spot.name}
                </div>`,
                offset: new AMap.Pixel(-15, -30)
            });
            currentMarker.setMap(map);

            // æ˜¾ç¤ºä¿¡æ¯çª—å£
            const infoWindow = new AMap.InfoWindow({
                content: buildSpotInfo(spot),
                offset: new AMap.Pixel(0, -30)
            });
            infoWindow.open(map, spot.location);

            // æ›´æ–°UI
            document.getElementById('content').innerHTML = `
                <b>${spot.name}</b><br>
                <span class="highlight">è¯„åˆ†: ${spot.rating}</span><br>
                ${spot.address}<br>
                ${spot.tel ? 'ç”µè¯: ' + spot.tel : ''}
                ${spot.photos.length > 0 ? 
                    `<img src="${spot.photos[0].url}" class="spot-img">` : ''}
            `;

            // å®šä½åˆ°è¯¥ç‚¹
            map.setZoomAndCenter(15, spot.location);
        }

        // æ„å»ºæ™¯ç‚¹ä¿¡æ¯HTML
        function buildSpotInfo(spot) {
            let html = `<div style="padding:5px;min-width:200px">
                <div style="font-weight:bold">${spot.name}</div>
                <div>åœ°å€: ${spot.address}</div>`;
            
            if (spot.tel) html += `<div>ç”µè¯: ${spot.tel}</div>`;
            if (spot.rating) html += `<div>è¯„åˆ†: ${spot.rating}</div>`;
            
            if (spot.photos.length > 0) {
                html += `<img src="${spot.photos[0].url}" style="width:100%;margin-top:5px">`;
            }
            
            html += `</div>`;
            return html;
        }

        // å¾®ä¿¡é€‚é…åˆå§‹åŒ–
        function init() {
            if (typeof WeixinJSBridge !== 'undefined') {
                document.addEventListener('WeixinJSBridgeReady', loadAMapSpots, false);
            } else {
                loadAMapSpots();
            }
        }
        window.onload = init;
    </script>
</body>
</html>