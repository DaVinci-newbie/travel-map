<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>中国旅行目的地随机选择</title>
    <!-- 使用国内CDN加速 -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/leaflet/1.7.1/leaflet.min.css">
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f7f7f7;
            height: 100vh;
            overflow: hidden;
        }
        #map-container {
            position: relative;
            height: 60vh;
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        #map {
            height: 100%;
        }
        #controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        button {
            width: 100%;
            padding: 12px;
            background: #07C160;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .result {
            font-size: 14px;
            line-height: 1.5;
        }
        .highlight {
            color: #07C160;
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="map-container">
        <div id="map"></div>
    </div>
    <div id="controls">
        <button onclick="selectRandomDestination()">🎲 随机选择目的地</button>
        <div id="result" class="result">
            点击按钮随机选择旅行目的地<br>
            <span class="highlight">包含全国热门景区和旅行路线</span>
        </div>
    </div>

    <!-- 使用国内CDN加速 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>
    <script>
        // 微信环境特殊处理
        function setupForWeixin() {
            // 解决微信中地图拖动问题
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('#map')) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // 解决点击延迟
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON') {
                    e.preventDefault();
                    e.target.click();
                }
            }, true);
        }
        
        // 初始化地图
        function initMap() {
            const map = L.map('map').setView([35.8617, 104.1954], 5);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap',
                maxZoom: 18
            }).addTo(map);
            
            return map;
        }
        
        // 目的地数据
        const destinations = [
            { name: "北京故宫", coordinates: [39.9163, 116.3903], type: "5A", region: "华北" },
            { name: "杭州西湖", coordinates: [30.2444, 120.1294], type: "5A", region: "华东" },
            { name: "桂林漓江", coordinates: [25.2345, 110.1799], type: "5A", region: "华南" },
            // 其他目的地数据...
        ];
        
        document.addEventListener('DOMContentLoaded', function() {
            // 检测微信环境
            if (/MicroMessenger/i.test(navigator.userAgent)) {
                setupForWeixin();
                alert("温馨提示：在微信中长按地图可以拖动查看");
            }
            
            const map = initMap();
            let currentMarker = null;
            
            window.selectRandomDestination = function() {
                if (currentMarker) {
                    map.removeLayer(currentMarker);
                }
                
                const selected = destinations[Math.floor(Math.random() * destinations.length)];
                
                currentMarker = L.marker(selected.coordinates, {
                    icon: L.divIcon({
                        html: '📍',
                        iconSize: [30, 30],
                        className: 'custom-marker'
                    })
                }).addTo(map);
                
                currentMarker.bindPopup(`
                    <b>${selected.name}</b><br>
                    地区: ${selected.region}<br>
                    类型: ${selected.type}级景区
                `).openPopup();
                
                document.getElementById('result').innerHTML = `
                    您选择的目的地是:<br>
                    <span class="highlight">${selected.name}</span><br>
                    位于: ${selected.region}地区
                `;
                
                map.flyTo(selected.coordinates, 8, {
                    duration: 1
                });
            }
            
            // 初始选择
            selectRandomDestination();
        });
    </script>
</body>
</html>